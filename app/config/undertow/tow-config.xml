<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE aspectran PUBLIC "-//ASPECTRAN//DTD Aspectran Configuration 6.0//EN"
        "http://aspectran.github.io/dtd/aspectran-6.dtd">
<aspectran>

    <description>
        An Aspectran configuration for Undertow Server.
    </description>

    <environment>
        <properties>
            <item name="tow.server.startup" valueType="boolean">true</item>
            <item name="tow.server.listener1.port" valueType="int">8080</item>
            <item name="tow.server.listener1.host">0.0.0.0</item>
        </properties>
    </environment>

    <bean id="tow.server" class="com.aspectran.undertow.server.TowServer">
        <properties>
            <item name="autoStart">%{tow.server.startup}</item>
            <item name="listeners" type="array">
                <value>
                    <bean class="io.undertow.Undertow$ListenerBuilder">
                        <properties>
                            <item name="type">#{field:io.undertow.Undertow$ListenerType^HTTP}</item>
                            <item name="port" valueType="int">%{tow.server.listener1.port}</item>
                            <item name="host">%{tow.server.listener1.host}</item>
                        </properties>
                    </bean>
                </value>
            </item>
            <item name="handler">#{tow.defaultServletHandler}</item>
        </properties>
    </bean>

    <bean id="tow.defaultServletHandler" class="com.aspectran.undertow.server.handlers.servlet.ServletHandlerFactoryBean" scope="prototype">
        <properties>
            <item name="towServletContainer">#{tow.defaultServletContainer}</item>
        </properties>
    </bean>

    <bean id="tow.defaultServletContainer" class="com.aspectran.undertow.server.handlers.servlet.TowServletContainer" scope="prototype">
        <properties>
            <item name="towServletContexts" type="array">
                <value>#{tow.defaultServletContext}</value>
            </item>
        </properties>
    </bean>

    <bean id="tow.defaultServletContext" class="com.aspectran.undertow.server.handlers.servlet.TowServletContext" scope="prototype">
        <properties>
            <item name="deploymentName">jpetsotre.war</item>
            <item name="contextPath">/</item>
            <item name="resourceBase">/webapps/default/assets</item>
            <item name="servlets" type="array">
                <value>#{tow.webActivityServlet}</value>
            </item>
            <item name="filters" type="array">
                <value>#{tow.webActivityFilter}</value>
            </item>
            <item name="filterServletMappings" type="array">
                <bean class="com.aspectran.undertow.server.handlers.servlet.TowFilterServletMapping">
                    <arguments>
                        <item>web-activity-filter</item>
                        <item>web-activity-servlet</item>
                    </arguments>
                </bean>
            </item>
        </properties>
    </bean>

    <bean id="tow.webActivityServlet" class="com.aspectran.undertow.server.handlers.servlet.TowServlet" scope="prototype">
        <arguments>
            <item>web-activity-servlet</item>
            <item>com.aspectran.web.startup.servlet.WebActivityServlet</item>
        </arguments>
        <properties>
            <item name="mappings" type="array">
                <value>/</value>
            </item>
            <item name="loadOnStartup" valueType="int">1</item>
        </properties>
    </bean>

    <bean id="tow.webActivityFilter" class="com.aspectran.undertow.server.handlers.servlet.TowFilter" scope="prototype">
        <arguments>
            <item>web-activity-filter</item>
            <item>com.aspectran.web.startup.filter.WebActivityFilter</item>
        </arguments>
        <properties>
            <item name="initParams" type="map">
                <entry name="bypasses">
                    /assets/**
                    /css/**
                    /images/**
                    /**/*.html
                </entry>
            </item>
        </properties>
    </bean>

</aspectran>